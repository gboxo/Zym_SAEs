# Visualize protein regions with highest KL divergence between 2 models




To investigate what happens when we perfrom DPO on a model to increase Enzyme activity, we will collect the KL divergence between 2 models; The base ZymCTRL and the DPO model at the last ieration.




We will collect the KL divergece in 4 sets of data (starting with one):
    - Natural Alpha Amylases (we will start here)
    - Alpha Amylases from the DMS
    - Alpha Amylases Generated by the base model
    - Alpha Amylases Generated by the DPO model



Once we've computed the LK divergence will inspect with pymol.


If there's something interesting, we migh then try to correlated the KL divergence with some secondary structures atuomatically.





**dataset_3/eval**




Important positions (token wise with prompt)

[50 rows x 9 columns]

Position Statistics:
    Position  Count    Avg KL  Same Token %                                    Top Transitions
34       293    156  1.179559      0.000000                    [440 (I) → 442 (L) (156 times)]
17       199    153  0.974342      0.000000                    [435 (D) → 447 (Q) (153 times)]
32       285    152  7.382440      5.000000                    [449 (S) → 442 (L) (152 times)]
10       102    151  0.985176      3.205128                    [440 (I) → 442 (L) (151 times)]
18       224    149  0.931642      1.973684                    [435 (D) → 436 (E) (149 times)]



## Experiment 1

1) Get the sequences
2) Get the positions (corrected by the prompty prefix)
3) Create variations of the seuqneces following the transition patterns



**Sequence activity with the transition from 3 --> 2**

| pos | count  |   mean    |   std    |    min    |    25%    |    50%    |    75%    |    max    |
|-----|--------|-----------|----------|-----------|-----------|-----------|-----------|-----------|
| 130 | 384.0  | 2.646982  | 0.663487 | 1.281582  | 2.152077  | 2.476407  | 3.119710  | 3.996138  |
| 277 | 128.0  | 2.657540  | 0.430194 | 1.788599  | 2.342824  | 2.570031  | 2.968892  | 3.893678  |
| 285 | 188.0  | 2.912250  | 0.485765 | 1.671306  | 2.582961  | 2.978712  | 3.248793  | 4.388328  |
| 94  | 249.0  | 2.481956  | 0.612240 | 1.299895  | 2.101680  | 2.338643  | 2.680548  | 4.248335  |
| 99  | 405.0  | 1.892914  | 0.543320 | 0.670250  | 1.440820  | 1.875448  | 2.317334  | 3.097492  |

**Sequence activity generated by model it 3**

| pos | count  |   mean    |   std    |    min    |    25%    |    50%    |    75%    |    max    |
|-----|--------|-----------|----------|-----------|-----------|-----------|-----------|-----------|
| 130 | 384.0  | 2.790399  | 0.739783 | 1.374829  | 2.262046  | 2.579765  | 3.286760  | 4.331516  |
| 277 | 128.0  | 2.619301  | 0.412740 | 1.832641  | 2.309202  | 2.579765  | 2.920377  | 3.625864  |
| 285 | 188.0  | 3.325657  | 0.752752 | 1.664367  | 2.603653  | 3.528600  | 3.971519  | 4.765147  |
| 94  | 249.0  | 2.569583  | 0.598022 | 1.374829  | 2.211350  | 2.438908  | 2.818470  | 4.260925  |
| 99  | 405.0  | 2.812990  | 0.748808 | 1.374829  | 2.264405  | 2.591897  | 3.462851  | 4.331516  |



**We can maybe try to understand the circuit in the model that shifts the probability distribution at pos 99**



## Top features for each type of important residue transition


**Pos 285 (with prompt)**

Reported positions with prompt

pos: 8, feat: 13549, value: 1251.579833984375
pos: 112, feat: 9611, value: 638.9197998046875
pos: 9, feat: 9755, value: 633.9202270507812
pos: 112, feat: 7127, value: 577.1336059570312
pos: 15, feat: 3394, value: 534.1064453125
pos: 12, feat: 13263, value: 531.7164916992188
pos: 123, feat: 7127, value: 496.07855224609375
pos: 106, feat: 2174, value: 491.7792053222656
pos: 12, feat: 14080, value: 467.4736328125
pos: 118, feat: 12002, value: 448.002197265625

**Position 293**

pos: 8, feat: 13549, value: 1128.91455078125
pos: 9, feat: 9755, value: 747.29638671875
pos: 106, feat: 2174, value: 729.7738037109375
pos: 18, feat: 14080, value: 705.2520751953125
pos: 18, feat: 9611, value: 704.0300903320312
pos: 18, feat: 6288, value: 614.9053344726562
pos: 83, feat: 1712, value: 585.9773559570312
pos: 15, feat: 15011, value: 569.6403198242188
pos: 190, feat: 4482, value: 553.1652221679688
pos: 9, feat: 5692, value: 544.3516235351562

**Position 107**


pos: 18, feat: 14080, value: 1896.08056640625
pos: 106, feat: 2174, value: 1363.6248779296875
pos: 24, feat: 4192, value: 1361.1268310546875
pos: 18, feat: 9611, value: 1293.00732421875
pos: 15, feat: 14080, value: 1137.3916015625
pos: 48, feat: 6396, value: 885.578369140625
pos: 70, feat: 14230, value: 747.0350952148438
pos: 13, feat: 10127, value: 744.1044921875
pos: 10, feat: 9225, value: 681.0491943359375
pos: 8, feat: 13549, value: 671.733642578125

**Position 102**

pos: 18, feat: 14080, value: 1255.2135009765625
pos: 8, feat: 13549, value: 1204.3590087890625
pos: 18, feat: 9611, value: 781.585693359375
pos: 15, feat: 14080, value: 618.0743408203125
pos: 18, feat: 5152, value: 530.7056884765625
pos: 18, feat: 12243, value: 455.3218078613281
pos: 13, feat: 10127, value: 446.6474609375
pos: 31, feat: 14080, value: 445.3908996582031
pos: 22, feat: 14080, value: 409.1334228515625
pos: 77, feat: 14080, value: 408.858642578125

**Position 138**

pos: 8, feat: 6094, value: 2447.462890625
pos: 12, feat: 14080, value: 1649.7188720703125
pos: 12, feat: 13263, value: 1586.8541259765625
pos: 114, feat: 12002, value: 1289.701416015625
pos: 128, feat: 3101, value: 1139.06640625
pos: 128, feat: 12002, value: 1033.858154296875
pos: 129, feat: 12002, value: 985.0537109375
pos: 12, feat: 11406, value: 980.8464965820312
pos: 73, feat: 5316, value: 882.7243041992188
pos: 128, feat: 7914, value: 835.18359375


all_features = [13549, 9611, 9755, 7127, 3394, 13263, 7127, 2174, 14080, 12002, 13549, 9755, 2174, 14080, 9611, 6288, 1712, 15011, 4482, 5692, 14080, 2174, 4192, 9611, 14080, 6396, 14230, 10127, 9225, 13549, 6094, 14080, 13263, 12002, 3101, 12002, 12002, 11406, 5316, 7914]
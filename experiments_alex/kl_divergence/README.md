# Visualize protein regions with highest KL divergence between 2 models




To investigate what happens when we perfrom DPO on a model to increase Enzyme activity, we will collect the KL divergence between 2 models; The base ZymCTRL and the DPO model at the last ieration.




We will collect the KL divergece in 4 sets of data (starting with one):
    - Natural Alpha Amylases (we will start here)
    - Alpha Amylases from the DMS
    - Alpha Amylases Generated by the base model
    - Alpha Amylases Generated by the DPO model



Once we've computed the LK divergence will inspect with pymol.


If there's something interesting, we migh then try to correlated the KL divergence with some secondary structures atuomatically.





**dataset_3/eval**




Important positions (token wise with prompt)

[50 rows x 9 columns]

Position Statistics:
    Position  Count    Avg KL  Same Token %                                    Top Transitions
34       293    156  1.179559      0.000000                    [440 (I) → 442 (L) (156 times)]
17       199    153  0.974342      0.000000                    [435 (D) → 447 (Q) (153 times)]
32       285    152  7.382440      5.000000                    [449 (S) → 442 (L) (152 times)]
10       102    151  0.985176      3.205128                    [440 (I) → 442 (L) (151 times)]
18       224    149  0.931642      1.973684                    [435 (D) → 436 (E) (149 times)]



## Experiment 1

1) Get the sequences
2) Get the positions (corrected by the prompty prefix)
3) Create variations of the seuqneces following the transition patterns



**Sequence activity with the transition from 3 --> 2**

| pos | count  |   mean    |   std    |    min    |    25%    |    50%    |    75%    |    max    |
|-----|--------|-----------|----------|-----------|-----------|-----------|-----------|-----------|
| 130 | 384.0  | 2.646982  | 0.663487 | 1.281582  | 2.152077  | 2.476407  | 3.119710  | 3.996138  |
| 277 | 128.0  | 2.657540  | 0.430194 | 1.788599  | 2.342824  | 2.570031  | 2.968892  | 3.893678  |
| 285 | 188.0  | 2.912250  | 0.485765 | 1.671306  | 2.582961  | 2.978712  | 3.248793  | 4.388328  |
| 94  | 249.0  | 2.481956  | 0.612240 | 1.299895  | 2.101680  | 2.338643  | 2.680548  | 4.248335  |
| 99  | 405.0  | 1.892914  | 0.543320 | 0.670250  | 1.440820  | 1.875448  | 2.317334  | 3.097492  |

**Sequence activity generated by model it 3**

| pos | count  |   mean    |   std    |    min    |    25%    |    50%    |    75%    |    max    |
|-----|--------|-----------|----------|-----------|-----------|-----------|-----------|-----------|
| 130 | 384.0  | 2.790399  | 0.739783 | 1.374829  | 2.262046  | 2.579765  | 3.286760  | 4.331516  |
| 277 | 128.0  | 2.619301  | 0.412740 | 1.832641  | 2.309202  | 2.579765  | 2.920377  | 3.625864  |
| 285 | 188.0  | 3.325657  | 0.752752 | 1.664367  | 2.603653  | 3.528600  | 3.971519  | 4.765147  |
| 94  | 249.0  | 2.569583  | 0.598022 | 1.374829  | 2.211350  | 2.438908  | 2.818470  | 4.260925  |
| 99  | 405.0  | 2.812990  | 0.748808 | 1.374829  | 2.264405  | 2.591897  | 3.462851  | 4.331516  |



**We can maybe try to understand the circuit in the model that shifts the probability distribution at pos 99**